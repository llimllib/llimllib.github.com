<html>
 <head>
  <style type="text/css">
body, html {
    margin:0;
    padding:0;
    background:white;
    color:#000;
}
body {
    min-width: 750px;
    font-size: 62.5%;
}
#wrap { margin:0 auto; width:100%; }
#canvascontainer {
    margin-left: 5px;
    margin-top: 5px;
    width: 320px;
    float: left;
    position: fixed;
    font-size: 1.8em;
}
#explain { font-size: 1.4em; }

#codebox {
    height:26px;
    border: 1px solid LightGray;
    margin-top: 10px;
}
#libraryBox {
    height:26px;
}
#libraryContainer {
    border: 1px solid LightGray;
    margin-top: 10px;
    font-size: 1.4em;
}
#textcontainer {
    font-size: 1.4em;
    margin-left: 320px;
    margin-right: 10px;
    margin-top:   10px;
}

#footer {clear:both;}

#canvas { border: 1px solid DarkGray; }
#libraryBox { border: 1px solid DarkGray; }
a:link { color: #333; }
a:visited { color: #999; }
h1 { font: Strong 18px Cambria, Georgia, Times New Roman, Calibri, serif;
     margin-left: 10px;
}
#nextLink { float:right;
    margin-right:30px
}

    </style>
    <!-- jquery -->
    <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>

    <!-- jquery UI -->
    <link type="text/css" href="js/jquery-ui/css/smoothness/jquery-ui-1.8.17.custom.css" rel="Stylesheet" />
    <script type="text/javascript" src="js/jquery-ui/js/jquery-ui-1.8.17.custom.min.js"></script>

    <!-- CodeMirror -->
    <script type="text/javascript" src="js/CodeMirror-2.11/lib/codemirror.js"></script>
    <link rel="stylesheet" href="js/CodeMirror-2.11/lib/codemirror.css">
    <link rel="stylesheet" href="js/CodeMirror-2.11/theme/default.css">
    <script src="js/CodeMirror-2.11/mode/javascript/javascript.js"></script>

    <title>Canvas Tutorial - Introduction</title>
<script type="text/javascript">
var editor = undefined;
var libEditor = undefined;
var intervalID = undefined;

function runCode() {
    if (intervalID != undefined)
        clearInterval(intervalID);
    //TODO: handle exceptions somehow
    $("#canvas")[0].getContext("2d").clearRect(0,0,
      $("#canvas")[0].width,
      $("#canvas")[0].height);

    //if there's a library defined, eval it
    if (libEditor != undefined) eval(libEditor.getValue());

        intervalID = eval($("#hidden_code").val());
}

$(document).ready(function(){


    $("#tabs").tabs();
        $("#tabs").tabs("remove", 1);

    $("#tabs").bind("tabsselect", function(evt, ui) {
        if (libEditor) {
            libEditor.refresh();
        }
        console.log("here");
    });

    $("#runButton").click(runCode).removeAttr("disabled");
});
  </script>
 </head>
 <body>
     <textarea id="hidden_code" style="display:none">var x = 25;
var y = 250;
var dx = 1.5;
var dy = -4;
var ctx;
var WIDTH;
var HEIGHT;
var paddlex;
var paddleh = 10;
var paddlew = 75;
var rightDown = false;
var leftDown = false;
var canvasMinX = 0;
var canvasMaxX = 0;
var intervalId = 0;
var bricks;
var NROWS = 5;
var NCOLS = 5;
var BRICKWIDTH;
var BRICKHEIGHT = 15;
var PADDING = 1;

function init() {
  ctx = $('#canvas')[0].getContext("2d");
  WIDTH = $("#canvas").width();
  HEIGHT = $("#canvas").height();
  BRICKWIDTH = (WIDTH/NCOLS) - 1;
  paddlex = WIDTH / 2;
  canvasMinX = $("#canvas").offset().left;
  canvasMaxX = canvasMinX + WIDTH;
  intervalId = setInterval(draw, 10);
  return intervalId;
}

function circle(x,y,r) {
  ctx.beginPath();
  ctx.arc(x, y, r, 0, Math.PI*2, true);
  ctx.closePath();
  ctx.fill();
}

function rect(x,y,w,h) {
  ctx.beginPath();
  ctx.rect(x,y,w,h);
  ctx.closePath();
  ctx.fill();
}

function clear() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);
  rect(0,0,WIDTH,HEIGHT);
}

function onKeyDown(evt) {
  if (evt.keyCode == 39) rightDown = true;
  else if (evt.keyCode == 37) leftDown = true;
}

function onKeyUp(evt) {
  if (evt.keyCode == 39) rightDown = false;
  else if (evt.keyCode == 37) leftDown = false;
}

$(document).keydown(onKeyDown);
$(document).keyup(onKeyUp);

function onMouseMove(evt) {
  if (evt.pageX &gt; canvasMinX &amp;&amp; evt.pageX &lt; canvasMaxX) {
    paddlex = Math.max(evt.pageX - canvasMinX - (paddlew/2), 0);
    paddlex = Math.min(WIDTH - paddlew, paddlex);
  }
}

$(document).mousemove(onMouseMove);

function initbricks() {
    bricks = new Array(NROWS);
    for (i=0; i &lt; NROWS; i++) {
        bricks[i] = new Array(NCOLS);
        for (j=0; j &lt; NCOLS; j++) {
            bricks[i][j] = 1;
        }
    }
}

function drawbricks() {
  for (i=0; i &lt; NROWS; i++) {
    ctx.fillStyle = rowcolors[i];
    for (j=0; j &lt; NCOLS; j++) {
      if (bricks[i][j] == 1) {
        rect((j * (BRICKWIDTH + PADDING)) + PADDING,
             (i * (BRICKHEIGHT + PADDING)) + PADDING,
             BRICKWIDTH, BRICKHEIGHT);
      }
    }
  }
}

var ballr = 10;
var rowcolors = ["#FF1C0A", "#FFFD0A", "#00A308", "#0008DB", "#EB0093"];
var paddlecolor = "#FFFFFF";
var ballcolor = "#FFFFFF";
var backcolor = "#000000";

function draw() {
  ctx.fillStyle = backcolor;
  clear();
  ctx.fillStyle = ballcolor;
  circle(x, y, ballr);

  if (rightDown) paddlex += 5;
  else if (leftDown) paddlex -= 5;
  ctx.fillStyle = paddlecolor;
  rect(paddlex, HEIGHT-paddleh, paddlew, paddleh);

  drawbricks();

  //want to learn about real collision detection? go read
  // http://www.harveycartel.org/metanet/tutorials/tutorialA.html
  rowheight = BRICKHEIGHT + PADDING;
  colwidth = BRICKWIDTH + PADDING;
  row = Math.floor(y/rowheight);
  col = Math.floor(x/colwidth);
  //reverse the ball and mark the brick as broken
  if (y &lt; NROWS * rowheight &amp;&amp; row &gt;= 0 &amp;&amp; col &gt;= 0 &amp;&amp; bricks[row][col] == 1) {
    dy = -dy;
    bricks[row][col] = 0;
  }

  if (x + dx + ballr &gt; WIDTH || x + dx - ballr &lt; 0)
    dx = -dx;

  if (y + dy - ballr &lt; 0)
    dy = -dy;
  else if (y + dy + ballr &gt; HEIGHT - paddleh) {
    if (x &gt; paddlex &amp;&amp; x &lt; paddlex + paddlew) {
      //move the ball differently based on where it hit the paddle
      dx = 8 * ((x-(paddlex+paddlew/2))/paddlew);
      dy = -dy;
    }
    else if (y + dy + ballr &gt; HEIGHT)
      clearInterval(intervalId);
  }

  x += dx;
  y += dy;
}

init();
initbricks();</textarea>
 <div id="wrap">
   <!-- <div id="header">
   <h2>Breakout Tutorial</h2>
    </div>-->

    <div id="canvascontainer">
         <canvas id="canvas" width="300" height="300"></canvas>
         <div style="text-align:center">
             <input type="submit" value="run code" id="runButton" disabled/>
         </div>

         <ol id="toc">
                 <li><a href="index.html">Introduction</a></li>
                 <li><a href="ball.html">Draw a Circle</a></li>
                 <li><a href="color.html">Add Some Color</a></li>
                 <li><a href="move.html">Action</a></li>
                 <li><a href="library.html">Library: an Interlude</a></li>
                 <li><a href="bounce.html">Bounce</a></li>
                 <li><a href="paddle.html">Add a Paddle</a></li>
                 <li><a href="keyboard.html">The Keyboard</a></li>
                 <li><a href="mouse.html">The Mouse</a></li>
                 <li><a href="bricks.html">The Bricks</a></li>
                 <li><a href="finish.html">Finishing Touches</a></li>
                 <li><a href="coda.html">Coda</a></li>
         </ol>
    </div>

    <div id="textcontainer">
        <h1>Introduction</h1>
        <div id="tabs">
            <ul>
            <li><a href="#explain"><span>Code</span></a></li>
            <li><a href="#libraryContainer"><span>Library</span></a></li>
            <li><a href="#comments"><span>Comments</span></a></li>
            </ul>
            <div id="explain">Welcome! In this tutorial, we're going to create a breakout
clone that you can play in your browser, using javascript and the &lt;canvas&gt; element.
<p>In order to use this tutorial, you'll need to have a relatively recent version
of <a href="http://mozilla.com/firefox">Firefox</a>, <a
href="http://apple.com/safari">Safari</a>, or <a href="http://opera.com">Opera</a>.
You cannot use Internet Explorer, because Microsoft has decided not to implement the
&lt;canvas&gt; element in it.
<p><em>update</em>: 3 years after I wrote this tutorial, IE has implemented canvas.
This tutorial is untested in IE but ought to work in IE 9 or above.
<p>Before you read any further, click on the "run code" button on the left to
play the game that we'll end up creating.
<p>On every page, you'll be able to click the "run code" button to run the code
we've developed so far. Every page besides this one has an editor in it containing
the javascript code that will be run in the same box as the game as soon as you
click the button. You can make changes to the code, and see the results
instantly by clicking the "run code" button.
<p>In order to make our lives easier, I've included the <a
href="http://jquery.com">jQuery</a> framework in every page, which extends
javascript in your browser with some useful methods.
<p>If you have any comments or questions, feel free to leave a comment on the
"comments" tab.

                <p>
                    <a href="ball.html" id="nextLink">next</a>
            </div>

            <div id="libraryContainer">
            </div>

            <div id="comments">
    <!-- begin disqus block -->
    <div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/canvastutorial/embed.js"></script><noscript><a href="http://canvastutorial.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    <!-- end disqus block -->

            </div>
        </div>
    </div>

<!-- begin disqus block -->
<script type="text/javascript">
//<![CDATA[
(function() {
        var links = document.getElementsByTagName('a');
        var query = '?';
        for(var i = 0; i < links.length; i++) {
            if(links[i].href.indexOf('#disqus_thread') >= 0) {
                query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
            }
        }
        document.write('<script type="text/javascript" src="http://disqus.com/forums/canvastutorial/get_num_replies.js' + query + '"></' + 'script>');
    })();
<!-- end disqus block -->
//]]>
</script>

 </body>
</html>
